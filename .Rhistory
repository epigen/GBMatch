dev.off()
percent_dup=umiPerGene[,.N,by=c("Num_Obs","Cell Barcode")][,list(percent_dupl=sum(N[Num_Obs>1]/sum(N)*100)),by="Cell Barcode"]
pdf(paste0(out_dir,"/duplUMIs_percent_cell_hist.pdf"),height=6,width=6)
ggplot(percent_dup,aes(x=percent_dupl))+geom_histogram(bins=50,col="black",fill="grey",size=0.2)+xlab("Percent duplicate UMIs")+ylab("Number of cells")+ggtitle(paste0("Duplication rate: ",round(duplScore,3)))
dev.off()
library(data.table)
genomes=fread("/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/genomes_overview_ncbi20161013.txt")
genomes
genomes=fread("/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/genomes_overview_ncbi20161013.txt")
genomes
library(ggplot2)
ggplot(genomes,aes(x=`Size (Mb)`,y=Kingdom,fill=Kingdom))+geom_point(alpha=0.4,shape=21)
ggplot(genomes,aes(x=log10(`Size (Mb)`),y=Kingdom,fill=Kingdom))+geom_point(alpha=0.4,shape=21)
theme_set(theme_bw())
ggplot(genomes,aes(x=log10(`Size (Mb)`),y=Kingdom,fill=Kingdom))+geom_point(position=position_jitter(),alpha=0.4,shape=21)
ggplot(genomes,aes(x=log10(`Size (Mb)`),y=Kingdom,fill=Kingdom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,col="transparent")
ggplot(genomes,aes(x=log10(`Size (Mb)`),y=Kingdom,fill=Kingdom,col=Kingdom))+geom_point(position=position_jitter(),alpha=0.4,shape=21)
ggplot(genomes,aes(x=log10(`Size (Mb)`),y=Kingdom,fill=Kingdom,col=Kingdom))+geom_point(position=position_jitter(),alpha=0.1,shape=21)
genomes[,.N,by="Group"]
genomes[,.N,by=c("Group","Kingdom")]
genomes[,tax_group:=Kingdom,]
genomes=fread("/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/genomes_overview_ncbi20161013.txt")
genomes[,tax_group:=ifelse(Kingdom=="Eukaryota",Group,Kingdom),]
ggplot(genomes,aes(x=log10(`Size (Mb)`),y=tax_group,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.1,shape=21)
genomes[tax_group=="Other"]
ggplot(genomes[tax_group!="Other"],aes(x=log10(`Size (Mb)`),y=tax_group,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.1,shape=21)
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(x=log10(`Size (Mb)`),y=tax_group,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.1,shape=21)
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(x=log10(`Size (Mb)`),y=tax_group,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot()
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot()
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent")
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NULL)
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
genomes[,tax_group=factor(tax_group,levels=unique(tax_group[order(Kingdom)])),]
genomes[,tax_group:=factor(tax_group,levels=unique(tax_group[order(Kingdom)])),]
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
genomes[,tax_group:=factor(tax_group,levels=c("Viruses","Archea","Bacteria","Fungi","Protists","Animals","Plants"))),]
genomes[,tax_group:=factor(tax_group,levels=c("Viruses","Archea","Bacteria","Fungi","Protists","Animals","Plants")),]
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
genomes[,tax_group:=factor(tax_group,levels=c("Viruses","Archea","Bacteria","Fungi","Protists","Animals","Plants","Other","Viroids")),]
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
unique(genomes$tax_group)
genomes=fread("/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/genomes_overview_ncbi20161013.txt")
genomes[,tax_group:=ifelse(Kingdom=="Eukaryota",Group,Kingdom),]
genomes[,tax_group:=factor(tax_group,levels=c("Viruses","Archea","Bacteria","Fungi","Protists","Animals","Plants","Other","Viroids")),]
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
genomes=fread("/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/genomes_overview_ncbi20161013.txt")
genomes[,tax_group:=ifelse(Kingdom=="Eukaryota",Group,Kingdom),]
genomes[,tax_group:=factor(tax_group,levels=c("Viruses","Archaea","Bacteria","Fungi","Protists","Animals","Plants","Other","Viroids")),]
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
genomes
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=Kingdom,fill=Kingdom,col=Kingdom))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Kingdom,col=Kingdom))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Kingdom,col=Kingdom))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("grey","red","yellow","blue"))
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Kingdom,col=Kingdom))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("grey","red","yellow","blue"))+scale_fill_manual(values=c("grey","red","yellow","blue"))
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Kingdom,col=Kingdom))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="yellow","Eucaryota"="blue"))+scale_fill_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="yellow","Eucaryota"="blue"))
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Kingdom,col=Kingdom))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="yellow","Eukaryota"="blue"))+scale_fill_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="yellow","Eukaryota"="blue"))
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Kingdom,col=Kingdom))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))+scale_fill_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Kingdom,col=Kingdom))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("Viruses"="grey","Archaea"="firebrick","Bacteria"="orange","Eukaryota"="blue"))+scale_fill_manual(values=c("Viruses"="grey","Archaea"="firebrick","Bacteria"="orange","Eukaryota"="blue"))
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Kingdom,col=Kingdom))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))+scale_fill_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))
genomes
genomes[group=="Group"]
genomes[Group=="Animals"]
library(XML)
library(data.table)
library(ggplot2)
library(XML)
theme_set(theme_bw())
genomes=fread("/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/genomes_overview_ncbi20161013.txt")
genomes[,tax_group:=ifelse(Kingdom=="Eukaryota",Group,Kingdom),]
genomes[,tax_group:=factor(tax_group,levels=c("Viruses","Archaea","Bacteria","Fungi","Protists","Animals","Plants","Other","Viroids")),]
ggplot(genomes[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Kingdom,col=Kingdom))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))+scale_fill_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))
result <- xmlParse(file = "/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/taxonomy_result.xml")
result
taxonomy= xmlParse(file = "/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/taxonomy_result.xml")
taxonomy= xmlToDataFrame(file = "/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/taxonomy_result.xml")
taxonomy= xmlToDataFrame("/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/taxonomy_result.xml")
taxonomy
taxonomy= xmlToDataFrame("/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/taxonomy_result.xml")
write.table(taxonomy,"/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/taxonomy_result.tsv",sep="\t",quote=FALSE,row.names=FALSE)
taxonomy
tax=fread("/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/taxonomy_result.tsv")
tax
names(tax)
tax=fread("/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/taxonomy_result.tsv",drop=c("OtherNames","ParentTaxId","GeneticCode","MitoGeneticCode","LineageEx","CreateDate","UpdateDate","PubDate","Properties"))
tax
genomes
setnames(genomes,"Organism/Name","ScientificName")
genomes_annot=merge(genomes,tax,by="ScientificName")
genomes_annot
genomes_annot=merge(genomes,tax,by="ScientificName",all.x=TRUE)
genomes_annot
genomes_annot[,tax_group:=ifelse(Kingdom=="Eukaryota",Group,Kingdom),]
genomes_annot[,tax_group:=factor(tax_group,levels=c("Viruses","Archaea","Bacteria","Fungi","Protists","Animals","Plants","Other","Viroids")),]
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Kingdom,col=Kingdom))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))+scale_fill_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))
ggplot(genomes_annot[!is.na(Division)],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Division,col=Division))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
ggplot(genomes_annot[!is.na(Division)&!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Division,col=Division))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
ggplot(genomes_annot[!is.na(Division)&!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Division,col=Division))+geom_point(position=position_jitter(),alpha=0.5,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
ggplot(genomes_annot[!is.na(Division)&!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=Division,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
genomes_annot[Division=="Vertebrates"][order(`Size (Mb)`)]
ggplot(genomes_annot[!is.na(chr)&!is.na(Division)&!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=Division,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
ggplot(genomes_annot[!is.na(Chrs)&!is.na(Division)&!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=Division,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
ggplot(genomes_annot[!is.na(Chrs)&!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Kingdom,col=Kingdom))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))+scale_fill_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))
ggplot(genomes_annot[!is.na(Chrs)&!is.na(Division)&!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=Division,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
genomes_annot[!is.na(Chrs)&!is.na(Division)&!tax_group%in%c("Other","Viroids")]
genomes_annot[!is.na(Chrs)&!is.na(Division)&!tax_group%in%c("Other","Viroids")][tax_group="Animals"]
genomes_annot[!is.na(Chrs)&!is.na(Division)&!tax_group%in%c("Other","Viroids")][tax_group=="Animals"]
genomes_annot
ggplot(genomes_annot[!is.na(Chrs)&!is.na(Division)&!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=Group,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
ggplot(genomes_annot[!is.na(Chrs)&!is.na(Division)&!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
ggplot(genomes_annot[!is.na(Division)&!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Kingdom,col=Kingdom,shape=Chrs))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))+scale_fill_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Kingdom,col=Kingdom,shape=as.factor(Chrs)))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))+scale_fill_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))
genomes_annot[,assembled:=ifelse(is.na(Chrs),FALSE,TRUE),]
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Kingdom,col=Kingdom,shape==assembled)+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))+scale_fill_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Kingdom,col=Kingdom,shape=assembled)+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))+scale_fill_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,fill=Kingdom,col=Kingdom,shape=assembled))+geom_point(position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))+scale_fill_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=Kingdom,fill=Kingdom,col=Kingdom,shape=assembled))+geom_point(position=position_jitter(),alpha=0.1)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))+scale_fill_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group,fill=Kingdom,col=Kingdom))+geom_point(aes(shape=assembled),position=position_jitter(),alpha=0.1)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))+scale_fill_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+geom_point(aes(fill=assembled,col=assembled),position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+geom_point(aes(fill=assembled,col=assembled),position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="black","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))
ggplot(genomes_annot[tax_group=="Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
ggplot(genomes_annot[tax_group=="Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="black","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+geom_point(aes(fill=assembled,col=assembled),position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="black","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="black","TRUE"="red"))
ggplot(genomes_annot[tax_group=="Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))
genomes_annot[,SubGroup:=factor(SubGroup,levels=c("Flatworms","Roundworms","Insects","Fisches","Amphibians","Reptiles","Birds","Mammals")),]
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))
genomes_annot[,SubGroup:=factor(SubGroup,levels=c("Flatworms","Roundworms","Insects","Fishes","Amphibians","Reptiles","Birds","Mammals")),]
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))
genomes_annot=merge(genomes,tax,by="ScientificName",all.x=TRUE)
genomes_annot[,tax_group:=ifelse(Kingdom=="Eukaryota",Group,Kingdom),]
genomes_annot[,tax_group:=factor(tax_group,levels=c("Viruses","Archaea","Bacteria","Fungi","Protists","Animals","Plants","Other","Viroids")),]
genomes_annot[,assembled:=ifelse(is.na(Chrs),FALSE,TRUE),]
genomes_annot[,SubGroup:=factor(SubGroup,levels=c("Flatworms","Roundworms","Insects","Fishes","Amphibians","Reptiles","Birds","Mammals")),]
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=assembled,col=assembled)))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes()+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=assembled,col=assembled))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes()+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))
ggplot(genomes_annot[!is.na(Division)&!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=assembled,col=assembled))+geom_point(position=position_jitter(),alpha=0.5,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=assembled,col=assembled))+geom_point(position=position_jitter(),alpha=0.5,shape=21)+geom_boxplot(,fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))
ggplot(genomes_annot[!is.na(Division)&!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+geom_point(aes(fill=assembled,col=assembled),position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="black","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="black","TRUE"="red"))
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group,fill=Kingdom,col=Kingdom))+geom_point(aes(shape=assembled),position=position_jitter(),alpha=0.1)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))+scale_fill_manual(values=c("Viruses"="grey","Archaea"="red","Bacteria"="orange","Eukaryota"="blue"))
out="/scratch/lab_bock/jklughammer/projects/Thesis/"
dir.create(out)
pdf(file.path(out,"genome_sizes_all.pdf"),height=6,width=6)
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+geom_point(aes(fill=assembled,col=assembled),position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="black","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="black","TRUE"="red"))
dev.off()
pdf("",height=,width=file.path(out,"genome_sizes_all.pdf"),height=6,width=6)
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))
dev.off()
pdf(file.path(out,"genome_sizes_animals.pdf"),height=6,width=6)
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))
dev.off()
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))+coordflip()
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))+coord_flip()
pdf(file.path(out,"genome_sizes_animals.pdf"),height=5,width=5)
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))+coord_flip()
dev.off()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+geom_point(aes(fill=assembled,col=assembled),position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="black","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="black","TRUE"="red"))+coord_flip()
pdf(file.path(out,"genome_sizes_all.pdf"),height=4,width=5)
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+geom_point(aes(fill=assembled,col=assembled),position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="black","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="black","TRUE"="red"))+coord_flip()
dev.off()
pdf(file.path(out,"genome_sizes_animals.pdf"),height=4,width=5)
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))+coord_flip()
dev.off()
pdf(file.path(out,"genome_sizes_animals.pdf"),height=4,width=5)
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.1,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="black","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="black","TRUE"="red"))+coord_flip()
dev.off()
pdf(file.path(out,"genome_sizes_all.pdf"),height=4,width=5)
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+geom_point(aes(fill=assembled,col=assembled),position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))+coord_flip()
dev.off()
pdf(file.path(out,"genome_sizes_animals.pdf"),height=4,width=5)
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.1,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))+coord_flip()
dev.off()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(aes(fill=assembled,col=assembled),position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex()+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=100)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_color_gradient(low="white",high="blue")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=100)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="white",high="blue")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=100)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="blue",high="red")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=50)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="blue",high="red")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=50,position=position_jitter())+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="blue",high="red")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=50)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="blue",high="red")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=50)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="lightblue",high="red")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=50,fill=..count..)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="lightblue",high="red")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=50,aes(fill=..count..))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="lightblue",high="red")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group,fill=..count..))+stat_binhex(bins=50)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="lightblue",high="red")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group,alpha=..count..))+stat_binhex(bins=50)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="lightblue",high="red")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=50)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="lightblue",high="red")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=50,binwidth=c(1,1))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="lightblue",high="red")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=50,binwidth=c(0.5,0.5))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="lightblue",high="red")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=100,binwidth=c(0.5,0.5))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="lightblue",high="red")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=100,binwidth=c(0.5,0.5))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient2(low="lightblue",high="red")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=100,binwidth=c(0.5,0.5))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="lightblue",high="red",limits=c(0, 1000))+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=100,binwidth=c(0.5,0.5))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="lightblue",high="red",limits=c(0, 100))+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=100,binwidth=c(0.5,0.2))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="lightblue",high="red",limits=c(0, 100),na.value="red")+coord_flip()
pdf(file.path(out,"genome_sizes_all_hex.pdf"),height=4,width=5)
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=100,binwidth=c(0.5,0.2))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="lightblue",high="red",limits=c(0, 100),na.value="red")+coord_flip()
dev.off()
pdf(file.path(out,"genome_sizes_animals.pdf"),height=4,width=5)
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup,fill=tax_group,col=tax_group))+geom_point(position=position_jitter(),alpha=0.5,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))+coord_flip()
dev.off()
pdf(file.path(out,"genome_sizes_animals.pdf"),height=4,width=5)
ggplot(genomes_annot[tax_group=="Animals"&SubGroup!="Other Animals"],aes(y=log10(`Size (Mb)`),x=SubGroup))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembled,col=assembled))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))+coord_flip()
dev.off()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+stat_binhex(bins=100,binwidth=c(0.5,0.2))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_fill_gradient(low="lightblue",high="red",limits=c(0, 100),na.value="red")+coord_flip()
ggplot(genomes_annot[!tax_group%in%c("Other","Viroids")],aes(y=log10(`Size (Mb)`),x=tax_group,group=tax_group))+geom_point(aes(fill=assembled,col=assembled),position=position_jitter(),alpha=0.1,shape=21)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("FALSE"="grey","TRUE"="red"))+coord_flip()
genomes_annot
genomes_annot$tax_group
genomes_annot$SubGroup
library(data.table)
library(ggplot2)
theme_set(theme_bw())
out="/scratch/lab_bock/jklughammer/projects/Thesis/"
dir.create(out)
#taxonomy= xmlToDataFrame("/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/taxonomy_result.xml")
#write.table(taxonomy,"/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/taxonomy_result.tsv",sep="\t",quote=FALSE,row.names=FALSE)
tax=fread("/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/taxonomy_result.tsv",drop=c("OtherNames","ParentTaxId","GeneticCode","MitoGeneticCode","LineageEx","CreateDate","UpdateDate","PubDate","Properties"))
genomes_euks=fread("/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/genomes_euks.txt",drop=c("Replicons","RefSeq FTP","GenBank FTP"))
genomes_proks=fread("/data/groups/lab_bock/jklughammer/gitRepos/Thesis/meta/genomes_proks.txt",drop=c("Replicons","RefSeq FTP","GenBank FTP"))
genomes_euks[,Kingdom:="Eukaryota",]
genomes_proks[,Kingdom:="Prokaryota",]
cols=c("#Organism/Name","Kingdom","Group","SubGroup","Assembly","Size (Mb)","Genes","Proteins","Release Date","Level")
genomes=rbindlist(list(genomes_euks[,cols,with=FALSE],genomes_proks[,cols,with=FALSE]))
setnames(genomes,"#Organism/Name","ScientificName")
genomes_red=genomes[Genes!="-"]
genomes_red[,keep:=Assembly[which.max(Genes)],by=ScientificName]
genomes_red=genomes_red[keep==Assembly]
#check for dupl entries (should be empty)
genomes_red[duplicated(ScientificName)]
genomes_annot=merge(genomes_red,tax,by="ScientificName",all.x=TRUE)
##make custom annotation column
#randomly downsample bacteria
bac_rows=which(genomes_annot$Kingdom=="Prokaryota")
genomes_annot[sample(bac_rows,size=300,replace=FALSE),custom:="Prokaryota"]
genomes_annot[Group=="Protists",custom:="Protists"]
genomes_annot[Division=="Invertebrates"&Group=="Animals",custom:="Invertebrates"]
genomes_annot[Division%in%c("Vertebrates","Mammals","Primates","Rodents"),custom:="Vertebrates"]
genomes_annot[,custom:=factor(custom,levels=c("Vertebrates","Invertebrates","Protists","Prokaryota"))]
genomes_annot[,assembly_status:=ifelse(Level%in%c("Complete Genome","Chromosome"),"complete","incomplete"),]
genomes_annot[,assembly_status:=factor(assembly_status,levels=c("incomplete","complete")),]
genomes_annot[,Genes:=as.numeric(Genes),]
genomes_annot[,Proteins:=as.numeric(Proteins),]
genomes_annot[,annot_genes:=ifelse(Genes%in%c(sort(Genes,decreasing=TRUE)[c(1:3)],sort(Genes,decreasing=FALSE)[c(1:3)]),ScientificName,NA),by="custom"]
library(ggrepel)
ggplot(genomes_annot[!is.na(custom)&Genes>500],aes(y=log10(Genes),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_text_repel(aes(label=annot_genes))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+annotate(aes(label=annot_genes))+coord_flip()+xlab("")
ggplot(genomes_annot[!is.na(custom)&Genes>500],aes(y=log10(Genes),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_text_repel(aes(label=annot_genes))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")
genomes_annot_red=genomes_annot[!is.na(custom)&Genes>500]
genomes_annot_red[,annot_genes:=ifelse(Genes%in%c(sort(Genes,decreasing=TRUE)[c(1:3)],sort(Genes,decreasing=FALSE)[c(1:3)]),ScientificName,NA),by="custom"]
ggplot(genomes_annot_red,aes(y=log10(Genes),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_text_repel(aes(label=annot_genes))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")
ggplot(genomes_annot_red,aes(y=log10(Genes),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_text_repel(aes(label=annot_genes),(angle = 90)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")
ggplot(genomes_annot_red,aes(y=log10(Genes),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_text_repel(aes(label=annot_genes),angle = 90)+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")
genomes_annot_red[,annot_genes:=ifelse(Genes%in%c(sort(Genes,decreasing=TRUE)[c(1:3)],sort(Genes,decreasing=FALSE)[c(1:3)]),ScientificName,NA),by="custom"]
genomes_annot_red[,annot_proteins:=ifelse(Proteins%in%c(sort(Proteins,decreasing=TRUE)[c(1:3)],sort(Proteins,decreasing=FALSE)[c(1:3)]),ScientificName,NA),by="custom"]
genomes_annot_red[,annot_genome:=ifelse(`Size (Mb)`%in%c(sort(`Size (Mb)`,decreasing=TRUE)[c(1:3)],sort(`Size (Mb)`,decreasing=FALSE)[c(1:3)]),ScientificName,NA),by="custom"]
pdf(file.path(out,"complexity2.pdf"),height=4,width=6)
ggplot(genomes_annot_red,aes(y=log10(Genes),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_text_repel(aes(label=annot_genes))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(#Genes)")
ggplot(genomes_annot_red,aes(y=log10(Proteins),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_text_repel(aes(label=annot_proteins))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(#Proteins)")
ggplot(genomes_annot[!is.na(custom)],aes(y=log10(`Size (Mb)`),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_text_repel(aes(label=annot_genome))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(Genome size)[Mb]")
ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),y=log10(Genes)))+geom_point(position=position_jitter(),alpha=0.7,shape=21,aes(fill=custom,col=assembly_status))+scale_colour_manual(values=c("incomplete"="grey","complete"="black"))+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+xlab("log10(#Genes)")+ylab("log10(Genome size)[Mb]")
dev.off()
genomes_annot_red[,annot_genome:=ifelse(`Size (Mb)`%in%c(sort(`Size (Mb)`,decreasing=TRUE)[c(1:3)],sort(`Size (Mb)`,decreasing=FALSE)[c(1:3)]),ScientificName,NA),by="custom"]
pdf(file.path(out,"complexity2.pdf"),height=4,width=6)
ggplot(genomes_annot_red,aes(y=log10(Genes),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_text_repel(aes(label=annot_genes))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(#Genes)")
ggplot(genomes_annot_red,aes(y=log10(Proteins),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_text_repel(aes(label=annot_proteins))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(#Proteins)")
ggplot(genomes_annot_red,aes(y=log10(`Size (Mb)`),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_text_repel(aes(label=annot_genome))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(Genome size)[Mb]")
ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),y=log10(Genes)))+geom_point(position=position_jitter(),alpha=0.7,shape=21,aes(fill=custom,col=assembly_status))+scale_colour_manual(values=c("incomplete"="grey","complete"="black"))+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+xlab("log10(#Genes)")+ylab("log10(Genome size)[Mb]")
dev.off()
genomes_annot_red[!is.na(annot_gene)]
genomes_annot_red[!is.na(annot_genes)]
ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),y=log10(Genes)))+geom_point(position=position_jitter(),alpha=0.7,shape=21,aes(fill=custom,col=assembly_status))+geom_text_repel(aes(label=annot_genome))+geom_text_repel(aes(label=annot_gene))+scale_colour_manual(values=c("incomplete"="grey","complete"="black"))+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+xlab("log10(#Genes)")+ylab("log10(Genome size)[Mb]")+xlim(-1,4)+ylim(2,5.5)
ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),y=log10(Genes)))+geom_point(position=position_jitter(),alpha=0.7,shape=21,aes(fill=custom,col=assembly_status))+geom_text_repel(aes(label=annot_genome))+geom_text_repel(aes(label=annot_genes))+scale_colour_manual(values=c("incomplete"="grey","complete"="black"))+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+xlab("log10(#Genes)")+ylab("log10(Genome size)[Mb]")+xlim(-1,4)+ylim(2,5.5)
ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),y=log10(Genes)))+geom_point(position=position_jitter(),alpha=0.7,shape=21,aes(fill=custom,col=assembly_status))+geom_text_repel(aes(label=annot_genome))+geom_text_repel(aes(label=annot_genes))+scale_colour_manual(values=c("incomplete"="grey","complete"="black"))+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+xlab("log10(#Genes)")+ylab("log10(Genome size)[Mb]")+xlim(-0.9,4)+ylim(2.5,5)
pdf(file.path(out,"complexity2.pdf"),height=4,width=6)
ggplot(genomes_annot_red,aes(y=log10(Genes),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(#Genes)")
ggplot(genomes_annot_red,aes(y=log10(Proteins),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(#Proteins)")
ggplot(genomes_annot_red,aes(y=log10(`Size (Mb)`),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(Genome size)[Mb]")
ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),y=log10(Genes)))+geom_point(position=position_jitter(),alpha=0.7,shape=21,aes(fill=custom,col=assembly_status))+geom_text_repel(aes(label=annot_genome))+geom_text_repel(aes(label=annot_genes))+scale_colour_manual(values=c("incomplete"="grey","complete"="black"))+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+ylab("log10(#Genes)")+xlab("log10(Genome size)[Mb]")+xlim(-0.5,4)+ylim(2.5,5)
dev.off()
pdf(file.path(out,"complexity3.pdf"),height=4,width=6)
ggplot(genomes_annot_red,aes(y=log10(Genes),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(#Genes)")
ggplot(genomes_annot_red,aes(y=log10(Proteins),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(#Proteins)")
ggplot(genomes_annot_red,aes(y=log10(`Size (Mb)`),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(Genome size)[Mb]")
ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),y=log10(Genes)))+geom_point(position=position_jitter(),alpha=0.7,shape=21,aes(fill=custom,col=assembly_status))+geom_text_repel(aes(label=annot_genome))+geom_text_repel(aes(label=annot_genes))+scale_colour_manual(values=c("incomplete"="grey","complete"="black"))+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+ylab("log10(#Genes)")+xlab("log10(Genome size)[Mb]")+xlim(-0.5,4)+ylim(2.5,5)
dev.off()
genomes_annot_red[!is.na(annot_genes)]
log10(54207)
log10(49156)
genomes_annot_red=genomes_annot[!is.na(custom)&Genes>500]
genomes_annot_red[,annot_genes:=ifelse(Genes%in%c(sort(Genes,decreasing=TRUE)[c(1)],sort(Genes,decreasing=FALSE)[c(1)]),ScientificName,NA),by="custom"]
genomes_annot_red[,annot_proteins:=ifelse(Proteins%in%c(sort(Proteins,decreasing=TRUE)[c(1)],sort(Proteins,decreasing=FALSE)[c(1)]),ScientificName,NA),by="custom"]
genomes_annot_red[,annot_genome:=ifelse(`Size (Mb)`%in%c(sort(`Size (Mb)`,decreasing=TRUE)[c(1)],sort(`Size (Mb)`,decreasing=FALSE)[c(1)]),ScientificName,NA),by="custom"]
pdf(file.path(out,"complexity3.pdf"),height=4,width=6)
ggplot(genomes_annot_red,aes(y=log10(Genes),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(#Genes)")
ggplot(genomes_annot_red,aes(y=log10(Proteins),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(#Proteins)")
ggplot(genomes_annot_red,aes(y=log10(`Size (Mb)`),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(Genome size)[Mb]")
ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),y=log10(Genes)))+geom_point(position=position_jitter(),alpha=0.7,shape=21,aes(fill=custom,col=assembly_status))+geom_text_repel(aes(label=annot_genome))+geom_text_repel(aes(label=annot_genes))+scale_colour_manual(values=c("incomplete"="grey","complete"="black"))+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+ylab("log10(#Genes)")+xlab("log10(Genome size)[Mb]")+xlim(-0.5,4)+ylim(2.5,5)
dev.off()
genomes_annot_red[!is.na(annot_genome)]
genomes_annot_red[!is.na(annot_genome)&!is.na(annot_genes)]
genomes_annot_red[!is.na(annot_genome)&|is.na(annot_genes)]
genomes_annot_red[!is.na(annot_genome)|!is.na(annot_genes)]
log10(2738.700000)
dotpl=ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),y=log10(Genes)))+geom_point(position=position_jitter(),alpha=0.7,shape=21,aes(fill=custom,col=assembly_status))+geom_text(aes(label=annot_genome))+geom_text(aes(label=annot_genes))+scale_colour_manual(values=c("incomplete"="grey","complete"="black"))+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+ylab("log10(#Genes)")+xlab("log10(Genome size)[Mb]")+theme(legend.justification=c(0,1), legend.position=c(0,1))+xlim(-0.5,4)+ylim(2.5,5)
densx=ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),fill=custom))+geom_density(alpha=0.3)+theme(axis.title.x = element_blank(),axis.text.x = element_blank(),axis.ticks.x = element_blank())+xlim(-0.5,4)+ylim(c(0,0.04))+theme(legend.position="none")
densy=ggplot(sub,aes(x=log10(Genes),fill=custom))+geom_density(alpha=0.3)+coord_flip()+theme(axis.title.y = element_blank(),axis.text.y = element_blank(),axis.ticks.y = element_blank())+ylim(2.5,5)+ylim(c(0,0.04))+theme(legend.position="none")
densy=ggplot(sub,aes(x=log10(Genes),fill=custom))+geom_density(alpha=0.3)+coord_flip()+theme(axis.title.y = element_blank(),axis.text.y = element_blank(),axis.ticks.y = element_blank())+xlim(2.5,5)+ylim(c(0,0.04))+theme(legend.position="none")
deltaPlot <- ggplot(genomes_annot_red,aes(x=Proteins,fill=custom))+geom_density(alpha=0.3)+theme(axis.title.y = element_blank())+theme(legend.position="none")
grid.arrange(densx, deltaPlot, dotpl, densy, ncol=2, nrow=2, widths=c(4, 1.4), heights=c(1.4, 4))
library("gridExtra")
grid.arrange(densx, deltaPlot, dotpl, densy, ncol=2, nrow=2, widths=c(4, 1.4), heights=c(1.4, 4))
print(dotpl)
dotpl=ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),y=log10(Genes)))+geom_point(position=position_jitter(),alpha=0.7,shape=21,aes(fill=custom,col=assembly_status))+geom_text(aes(label=annot_genome))+geom_text(aes(label=annot_genes))+scale_colour_manual(values=c("incomplete"="grey","complete"="black"))+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+ylab("log10(#Genes)")+xlab("log10(Genome size)[Mb]")+theme(legend.justification=c(1,0), legend.position=c(1,0))+xlim(-0.5,4)+ylim(2.5,5)
print(dotpl)
print(densx)
densx=ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),fill=custom))+geom_density(alpha=0.3)+theme(axis.title.x = element_blank(),axis.text.x = element_blank(),axis.ticks.x = element_blank())+xlim(-0.5,4)+theme(legend.position="none")
print(densx)
densy=ggplot(sub,aes(x=log10(Genes),fill=custom))+geom_density(alpha=0.3)+coord_flip()+theme(axis.title.y = element_blank(),axis.text.y = element_blank(),axis.ticks.y = element_blank())+xlim(2.5,5)+theme(legend.position="none")
print(densy)
densy=ggplot(genomes_annot_red,aes(x=log10(Genes),fill=custom))+geom_density(alpha=0.3)+coord_flip()+theme(axis.title.y = element_blank(),axis.text.y = element_blank(),axis.ticks.y = element_blank())+xlim(2.5,5)+theme(legend.position="none")
print(densy)
deltaPlot <- ggplot(genomes_annot_red,aes(x=Proteins,fill=custom))+geom_density(alpha=0.3)+theme(axis.title.y = element_blank())+theme(legend.position="none")
grid.arrange(densx, deltaPlot, dotpl, densy, ncol=2, nrow=2, widths=c(4, 1.4), heights=c(1.4, 4))
dotpl=ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),y=log10(Genes)))+geom_point(position=position_jitter(),alpha=0.7,shape=21,aes(fill=custom,col=assembly_status))+geom_text(aes(label=annot_genome))+geom_text(aes(label=annot_genes))+scale_colour_manual(values=c("incomplete"="grey","complete"="black"))+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+ylab("log10(#Genes)")+xlab("log10(Genome size)[Mb]")+theme(legend.justification=c(1,0), legend.position=c(1,0))+xlim(-0.5,4)+ylim(2.5,5)
densx=ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),fill=custom))+geom_density(alpha=0.3)+theme(axis.title.x = element_blank(),axis.text.x = element_blank(),axis.ticks.x = element_blank())+xlim(-0.5,4)+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+theme(legend.position="none")
densy=ggplot(genomes_annot_red,aes(x=log10(Genes),fill=custom))+geom_density(alpha=0.3)+coord_flip()+theme(axis.title.y = element_blank(),axis.text.y = element_blank(),axis.ticks.y = element_blank())+xlim(2.5,5)+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+theme(legend.position="none")
deltaPlot <- ggplot(genomes_annot_red,aes(x=Proteins,fill=custom))+geom_density(alpha=0.3)+theme(axis.title.y = element_blank())+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+theme(legend.position="none")
grid.arrange(densx, deltaPlot, dotpl, densy, ncol=2, nrow=2, widths=c(4, 1.4), heights=c(1.4, 4))
deltaPlot <- ggplot(genomes_annot_red,aes(x=Proteins,fill=custom))+geom_bar(width = 1)+coord_polar(theta = "y")+theme(axis.title.y = element_blank())+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+theme(legend.position="none")
grid.arrange(densx, deltaPlot, dotpl, densy, ncol=2, nrow=2, widths=c(4, 1.4), heights=c(1.4, 4))
deltaPlot <- ggplot(genomes_annot_red,aes(x=factor(1),fill=custom))+geom_bar(width = 1)+coord_polar(theta = "y")+theme(axis.title.y = element_blank())+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+theme(legend.position="none")
grid.arrange(densx, deltaPlot, dotpl, densy, ncol=2, nrow=2, widths=c(4, 1.4), heights=c(1.4, 4))
deltaPlot <- ggplot(genomes_annot_red,aes(x=factor(1),fill=custom))+geom_bar(width = 1)+coord_polar(theta = "y")+theme(axis.title = element_blank(),axis.text = element_blank(),axis.ticks = element_blank())+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+theme(legend.position="none")
grid.arrange(densx, deltaPlot, dotpl, densy, ncol=2, nrow=2, widths=c(4, 1.4), heights=c(1.4, 4))
deltaPlot <- ggplot(genomes_annot_red,aes(x=factor(1),fill=custom))+geom_bar(width = 1)+coord_polar(theta = "y")+theme(axis.title = element_blank(),axis.text = element_blank(),axis.ticks = element_blank())+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+geom_text(stat='count',aes(label=..count..),vjust=-1)+theme(legend.position="none")
grid.arrange(densx, deltaPlot, dotpl, densy, ncol=2, nrow=2, widths=c(4, 1.4), heights=c(1.4, 4))
deltaPlot <- ggplot(genomes_annot_red,aes(x=factor(1),fill=custom))+geom_bar(width = 1)+coord_polar(theta = "y")+theme(axis.title = element_blank(),axis.text = element_blank(),axis.ticks = element_blank())+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+geom_text(stat='count',aes(label=..count..))+theme(legend.position="none")
grid.arrange(densx, deltaPlot, dotpl, densy, ncol=2, nrow=2, widths=c(4, 1.4), heights=c(1.4, 4))
deltaPlot <- ggplot(genomes_annot_red,aes(x=factor(1),fill=custom))+geom_bar(width = 1)+coord_polar(theta = "y")+theme(axis.title = element_blank(),axis.text = element_blank(),axis.ticks = element_blank())+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+geom_text(stat='count',aes(y=..count..,label=..count..))+theme(legend.position="none")
grid.arrange(densx, deltaPlot, dotpl, densy, ncol=2, nrow=2, widths=c(4, 1.4), heights=c(1.4, 4))
deltaPlot <- ggplot(genomes_annot_red,aes(x=factor(1),fill=custom))+geom_bar(width = 1)+coord_polar(theta = "y")+theme(axis.title = element_blank(),axis.text = element_blank(),axis.ticks = element_blank())+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+geom_text(stat='count',aes(y=..count../2,label=..count..))+theme(legend.position="none")
grid.arrange(densx, deltaPlot, dotpl, densy, ncol=2, nrow=2, widths=c(4, 1.4), heights=c(1.4, 4))
deltaPlot <- ggplot(genomes_annot_red,aes(x=factor(1),fill=custom))+geom_bar(width = 1)+coord_polar(theta = "y")+theme(axis.title = element_blank(),axis.text = element_blank(),axis.ticks = element_blank())+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+geom_text(stat='count',aes(y=..count../2c(0, cumsum(..count..)[-length(..count..)]),label=..count..))+theme(legend.position="none")
deltaPlot <- ggplot(genomes_annot_red,aes(x=factor(1),fill=custom))+geom_bar(width = 1)+coord_polar(theta = "y")+theme(axis.title = element_blank(),axis.text = element_blank(),axis.ticks = element_blank())+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+geom_text(stat='count',aes(y=..count../2+c(0, cumsum(..count..)[-length(..count..)]),label=..count..))+theme(legend.position="none")
grid.arrange(densx, deltaPlot, dotpl, densy, ncol=2, nrow=2, widths=c(4, 1.4), heights=c(1.4, 4))
densx=ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),col=custom,fill=custom))+geom_density(alpha=0.3)+theme(axis.title.x = element_blank(),axis.text.x = element_blank(),axis.ticks.x = element_blank())+xlim(-0.5,4)+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+theme(legend.position="none")
densy=ggplot(genomes_annot_red,aes(x=log10(Genes),col=custom,fill=custom))+geom_density(alpha=0.3)+coord_flip()+theme(axis.title.y = element_blank(),axis.text.y = element_blank(),axis.ticks.y = element_blank())+xlim(2.5,5)+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+scale_col_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+theme(legend.position="none")
densx=ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),col=custom,fill=custom))+geom_density(alpha=0.3)+theme(axis.title.x = element_blank(),axis.text.x = element_blank(),axis.ticks.x = element_blank())+xlim(-0.5,4)+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+scale_color_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+theme(legend.position="none")
densy=ggplot(genomes_annot_red,aes(x=log10(Genes),col=custom,fill=custom))+geom_density(alpha=0.3)+coord_flip()+theme(axis.title.y = element_blank(),axis.text.y = element_blank(),axis.ticks.y = element_blank())+xlim(2.5,5)+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+scale_color_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+theme(legend.position="none")
deltaPlot <- ggplot(genomes_annot_red,aes(x=factor(1),fill=custom))+geom_bar(width = 1)+coord_polar(theta = "y")+theme(axis.title = element_blank(),axis.text = element_blank(),axis.ticks = element_blank())+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+geom_text(stat='count',aes(y=..count../2+c(0, cumsum(..count..)[-length(..count..)]),label=..count..))+theme(legend.position="none")
grid.arrange(densx, deltaPlot, dotpl, densy, ncol=2, nrow=2, widths=c(4, 1.4), heights=c(1.4, 4))
pdf(file.path(out,"complexity3.pdf"),height=7,width=7)
grid.arrange(densx, deltaPlot, dotpl, densy, ncol=2, nrow=2, widths=c(4, 1.4), heights=c(1.4, 4))
dev.off()
pdf(file.path(out,"genesVSgenomes.pdf"),height=7,width=7)
grid.arrange(densx, deltaPlot, dotpl, densy, ncol=2, nrow=2, widths=c(4, 1.4), heights=c(1.4, 4))
dev.off()
pdf(file.path(out,"complexity3.pdf"),height=4,width=6)
ggplot(genomes_annot_red,aes(y=log10(Genes),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(#Genes)")
ggplot(genomes_annot_red,aes(y=log10(Proteins),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(#Proteins)")
ggplot(genomes_annot_red,aes(y=log10(`Size (Mb)`),x=custom))+geom_point(position=position_jitter(),alpha=0.4,shape=21,aes(fill=assembly_status,col=assembly_status))+geom_boxplot(col="black",fill="transparent",outlier.colour=NA)+scale_colour_manual(values=c("FALSE"="grey","TRUE"="red"))+scale_fill_manual(values=c("incomplete"="grey","complete"="red"))+coord_flip()+xlab("")+ylab("log10(Genome size)[Mb]")
ggplot(genomes_annot_red,aes(x=log10(`Size (Mb)`),y=log10(Genes)))+geom_point(position=position_jitter(),alpha=0.7,shape=21,aes(fill=custom,col=assembly_status))+scale_colour_manual(values=c("incomplete"="grey","complete"="black"))+scale_fill_manual(values=c("Prokaryota"="#a6cee3","Protists"="#1f78b4","Invertebrates"="#b2df8a","Vertebrates"="#33a02c"))+ylab("log10(#Genes)")+xlab("log10(Genome size)[Mb]")+xlim(-0.5,4)+ylim(2.5,5)
dev.off()
genomes_annot_red[!is.na(annot_genes)]
?grid.arrange
?dist
library(data.table)
library(ggplot2)
library(reshape2)
theme_set(theme_bw())
data_dir="/scratch/lab_bock/shared/projects/crop-seq/results_pipeline/Drop-seq_HEK293T-3T3/"
out_dir="/scratch/lab_bock/shared/projects/crop-seq/mixing_hum_mouse"
dir.create(out_dir)
refFlat=fread("/data/groups/lab_bock/shared/resources/genomes/hg19_mm10_transgenes/hg19_mm10_transgenes.refFlat",drop=c(7:11))
setnames(refFlat,names(refFlat),c("GENE","transcript","chrom","strand","start","end"))
refFlat=refFlat[!grepl("ERCC",chrom),]
umiPerGene=fread(file.path(data_dir,"cell_umi_barcodes.500genes.tsv"))
dge=fread(file.path(data_dir,"digital_expression.500genes.tsv"))
#plot number of duplicate UMIs per cell
duplUMIs=umiPerGene[Num_Obs>1,.N,by="Cell Barcode"]
duplUMIs[,N_topped:=ifelse(N>1000,1000,N),]
duplScore=nrow(umiPerGene[Num_Obs>1])/nrow(umiPerGene)
pdf(paste0(out_dir,"/duplUMIs_per_cell_hist.pdf"),height=6,width=6)
ggplot(duplUMIs,aes(x=log10(N)))+geom_histogram(bins=40,col="black",fill="grey",size=0.2)+xlab("Number of duplicate UMIs (log10)")+ylab("Number of cells")+ggtitle(paste0("Duplication rate: ",round(duplScore,3)))
dev.off()
#plot percentage of duplicate UMIs per cell
percent_dup=umiPerGene[,.N,by=c("Num_Obs","Cell Barcode")][,list(percent_dupl=sum(N[Num_Obs>1]/sum(N)*100)),by="Cell Barcode"]
pdf(paste0(out_dir,"/duplUMIs_percent_cell_hist.pdf"),height=6,width=6)
ggplot(percent_dup,aes(x=percent_dupl))+geom_histogram(bins=50,col="black",fill="grey",size=0.2)+xlab("Percent duplicate UMIs")+ylab("Number of cells")+ggtitle(paste0("Duplication rate: ",round(duplScore,3)))
dev.off()
#actually analyze the expression data
dge=merge(refFlat,dge,by="GENE")
dge_long=melt(dge,id.vars=c("GENE","transcript","chrom","strand","start","end"),value.name="count",variable.name="cell_barcode")
dge_long[,species:=sub("_.*","",chrom),]
dge_long_uniq=unique(dge_long[,-grep("transcript|chrom|strand|start|end",names(dge_long)),with=FALSE])
dge_long_mean=dge_long_uniq[,list(g1=sum(count>=1),g5=sum(count>=5),g10=sum(count>=10),mean=mean(count[count>0])),by=c("cell_barcode","species")]
dge_long_mean[,diff_mh_g1:=g1[species=="MOUSE"]-g1[species=="HUMAN"],by="cell_barcode"]
dge_long_mean[,ratio_mh_g1:=g1[species=="MOUSE"]/g1[species=="HUMAN"],by="cell_barcode"]
dge_long_mean[,percent_g1:=g1/sum(g1)*100,by="cell_barcode"]
dge_long_mean[,total_g1:=sum(g1),by="cell_barcode"]
dge_long_mean[,species_dom:=ifelse(diff_mh_g1>0,"MOUSE",ifelse(diff_mh_g1<0,"HUMAN","tie")),]
dge_wide_mean=reshape(dge_long_mean,idvar="cell_barcode",timevar="species",direction="wide")
dge_wide_mean[,doublet:=ifelse(percent_g1.MOUSE>10&percent_g1.MOUSE<90,TRUE,FALSE),]
double_frac=(nrow(dge_wide_mean[percent_g1.MOUSE>10&percent_g1.MOUSE<90])*2)/nrow(dge_wide_mean)
#ratio plots
dge_long_mean[,cell_barcode:=factor(cell_barcode,levels=unique(cell_barcode[order(ratio_mh_g1)])),]
pdf(paste0(out_dir,"/species_ratio_g1.pdf"),height=7,width=5)
ggplot(dge_long_mean[percent_g1!=0], aes(x=cell_barcode,y=percent_g1,fill=species,alpha=log10(total_g1)))+geom_bar(position="stack",stat="identity",col="transparent")+ggtitle(paste0("doublet-estimate: ",round(double_frac,3)*100,"%"))+theme(axis.text.y = element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank())+coord_flip()+xlab("Cells")+ylab("% of total detected genes")
dev.off()
#mouse vs. human
pdf(paste0(out_dir,"/species_cor_g1.pdf"),height=6,width=5)
ggplot(dge_wide_mean, aes(x=log10(g1.MOUSE),y=log10(g1.HUMAN),fill=species_dom.MOUSE,col=doublet))+geom_abline(slope=1)+geom_point(shape=21,alpha=0.4,size=2)+theme(legend.position="bottom")+ggtitle(paste0("doublet-estimate: ",round(double_frac,3)*100,"%"))+xlim(c(0,4))+ylim(c(0,4))+scale_color_manual(values=c("TRUE"="black","FALSE"="grey"))
dev.off()
pdf(paste0(out_dir,"/species_cor_g1.pdf"),height=6,width=5)
ggplot(dge_wide_mean, aes(x=g1.MOUSE,y=g1.HUMAN,fill=species_dom.MOUSE,col=doublet))+geom_abline(slope=1)+geom_point(shape=21,alpha=0.4,size=2)+theme(legend.position="bottom")+ggtitle(paste0("doublet-estimate: ",round(double_frac,3)*100,"%"))+xlim(c(0,4))+ylim(c(0,4))+scale_color_manual(values=c("TRUE"="black","FALSE"="grey"))
dev.off()
pdf(paste0(out_dir,"/species_cor_g1.pdf"),height=6,width=5)
ggplot(dge_wide_mean, aes(x=log10(g1.MOUSE),y=log10(g1.HUMAN),fill=species_dom.MOUSE,col=doublet))+geom_abline(slope=1)+geom_point(shape=21,alpha=0.4,size=2)+theme(legend.position="bottom")+ggtitle(paste0("doublet-estimate: ",round(double_frac,3)*100,"%"))+xlim(c(0,4))+ylim(c(0,4))+scale_color_manual(values=c("TRUE"="black","FALSE"="grey"))
dev.off()
pdf(paste0(out_dir,"/species_cor_g1_noLog.pdf"),height=6,width=5)
ggplot(dge_wide_mean, aes(x=g1.MOUSE,y=g1.HUMAN,fill=species_dom.MOUSE,col=doublet))+geom_abline(slope=1)+geom_point(shape=21,alpha=0.4,size=2)+theme(legend.position="bottom")+ggtitle(paste0("doublet-estimate: ",round(double_frac,3)*100,"%"))+scale_color_manual(values=c("TRUE"="black","FALSE"="grey"))
dev.off()
data_dir="/scratch/lab_bock/shared/projects/crop-seq/results_pipeline/Drop-seq_HEK293T-3T3_resequenced/"
out_dir="/scratch/lab_bock/shared/projects/crop-seq/mixing_hum_mouse_resequenced"
dir.create(out_dir)
refFlat=fread("/data/groups/lab_bock/shared/resources/genomes/hg19_mm10_transgenes/hg19_mm10_transgenes.refFlat",drop=c(7:11))
setnames(refFlat,names(refFlat),c("GENE","transcript","chrom","strand","start","end"))
refFlat=refFlat[!grepl("ERCC",chrom),]
umiPerGene=fread(file.path(data_dir,"cell_umi_barcodes.500genes.tsv"))
dge=fread(file.path(data_dir,"digital_expression.500genes.tsv"))
library(Rsamtools)
library(data.table)
library(GenomicRanges)
bam_dir="/scratch/lab_bock/jklughammer/projects/compEpi_auto/results_pipeline/TD/crossMapping/sarHar1/"
dedRef_bam=scanBam(paste0(bam_dir,"/toSelf_filtered_0.08mm.bsmap.0.08.mism.1.r.0.n.bam"))
dedRef_bam_dt=data.table(dedRefID=dedRef_bam[[1]]$qname,map_chr=dedRef_bam[[1]]$rname,map_start=dedRef_bam[[1]]$pos,map_strand=dedRef_bam[[1]]$strand,width=dedRef_bam[[1]]$qwidth)
dedRef_bam_dt[,map_end:=map_start+width,]
dedRef_bam_dt=na.omit(dedRef_bam_dt)
dedRef_bam_gr=with(dedRef_bam_dt[!is.na(map_start)],GRanges(seqnames=Rle(map_chr),ranges=IRanges(start=map_start,end=map_end),strand="*"))
dedRef_bed=fread("/scratch/lab_bock/jklughammer/projects/compEpi_auto/results_pipeline/TD/reduced/consensus/toSelf_filtered_0.08mm_final_concat.bed",drop=c(5:9))
setnames(dedRef_bed,names(dedRef_bed),c("ded_chr","ded_start","ded_end","dedRefID"))
transcripts=fread("/data/groups/lab_bock/shared/resources/genomes/sarHar1/sarHar1_transcript_annotation.txt")
setnames(transcripts,names(transcripts),c("ensT","chr","strand","transc_start","transc_end","ensG","ensP","gene_name","type","transcript_name","protID"))
transcripts[,prom_start:=ifelse(strand=="+",pmax(transc_start-5000,0),pmax(transc_end-2500,0)),]
transcripts[,prom_end:=ifelse(strand=="+",transc_start+2500, transc_end+5000),]
transcripts
overlap=findOverlaps(query=dedRef_bam_gr,subject=transcripts_gr)
combined=cbind(dedRef_bam_dt[queryHits(overlap)],transcripts[subjectHits(overlap)])
#check unique covered genes
length((unique(combined$ensG)))
transcripts[,prom_start:=ifelse(strand=="+",pmax(transc_start-5000,0),pmax(transc_end-2500,0)),]
transcripts[,prom_end:=ifelse(strand=="+",transc_start+2500, transc_end+5000),]
transcripts_gr=with(transcripts,GRanges(seqnames=Rle(chr),ranges=IRanges(start=prom_start,end=prom_end),strand="*"))
overlap=findOverlaps(query=dedRef_bam_gr,subject=transcripts_gr)
combined=cbind(dedRef_bam_dt[queryHits(overlap)],transcripts[subjectHits(overlap)])
length((unique(combined$ensG)))
combined_unique=combined[,list(ensG=paste0(unique(ensG),collapse=" "),ensG=paste0(unique(ensT),collapse=" "),ensP=paste0(unique(ensP),collapse=" "),gene_name=paste0(unique(gene_name),collapse=" "),dist=ifelse(strand=="+",mean(map_start-transc_start),mean(transc_end-map_start))),by=c("dedRefID","strand")]
combined_unique
combined_unique=combined[,list(ensG=paste0(unique(ensG),collapse=" "),ensT=paste0(unique(ensT),collapse=" "),ensP=paste0(unique(ensP),collapse=" "),gene_name=paste0(unique(gene_name),collapse=" "),dist=ifelse(strand=="+",mean(map_start-transc_start),mean(transc_end-map_start))),by=c("dedRefID","strand")]
combined_unique
combined_unique_wide=reshape(combined_unique,timevar="strand",idvar="dedRefID",direction="wide")
combined_unique_wide
dedRef_bed_coord=merge(dedRef_bed,dedRef_bam_dt,by="dedRefID",all=TRUE)
combined_unique_wide_coord=merge(dedRef_bed_coord,combined_unique_wide,by="dedRefID",all=TRUE)
combined_unique_wide_coord
write.table(combined_unique_wide_coord,paste0(bam_dir,"/dedRef_sarHar1_annotation_ensT.tsv"),sep="\t",row.names=FALSE,quote=FALSE)
paste0(bam_dir,"/dedRef_sarHar1_annotation_ensT.tsv")
library(Rsamtools)
library(data.table)
library(GenomicRanges)
bam_dir="/scratch/lab_bock/jklughammer/projects/RefFreeDMA_others/Tasmanian_devil/crossMapping/sarHar1/"
dedRef_bam=scanBam(paste0(bam_dir,"/toSelf_filtered_0.08mm.bsmap.0.08.mism.1.r.0.n.bam"))
dedRef_bam_dt=data.table(dedRefID=dedRef_bam[[1]]$qname,map_chr=dedRef_bam[[1]]$rname,map_start=dedRef_bam[[1]]$pos,map_strand=dedRef_bam[[1]]$strand,width=dedRef_bam[[1]]$qwidth)
dedRef_bam_dt[,map_end:=map_start+width,]
dedRef_bam_dt=na.omit(dedRef_bam_dt)
dedRef_bam_gr=with(dedRef_bam_dt[!is.na(map_start)],GRanges(seqnames=Rle(map_chr),ranges=IRanges(start=map_start,end=map_end),strand="*"))
dedRef_bed=fread("/scratch/lab_bock/jklughammer/projects/RefFreeDMA_others/Tasmanian_devil/reduced/consensus/toSelf_filtered_0.08mm_final_concat.bed",drop=c(5:9))
setnames(dedRef_bed,names(dedRef_bed),c("ded_chr","ded_start","ded_end","dedRefID"))
transcripts=fread("/data/groups/lab_bock/shared/resources/genomes/sarHar1/sarHar1_transcript_annotation.txt")
setnames(transcripts,names(transcripts),c("ensT","chr","strand","transc_start","transc_end","ensG","ensP","gene_name","type","transcript_name","protID"))
transcripts[,prom_start:=ifelse(strand=="+",pmax(transc_start-5000,0),pmax(transc_end-2500,0)),]
transcripts[,prom_end:=ifelse(strand=="+",transc_start+2500, transc_end+5000),]
transcripts_gr=with(transcripts,GRanges(seqnames=Rle(chr),ranges=IRanges(start=prom_start,end=prom_end),strand="*"))
overlap=findOverlaps(query=dedRef_bam_gr,subject=transcripts_gr)
combined=cbind(dedRef_bam_dt[queryHits(overlap)],transcripts[subjectHits(overlap)])
#check unique covered genes
length((unique(combined$ensG)))
#one annotation per dedRefID
combined_unique=combined[,list(ensG=paste0(unique(ensG),collapse=" "),ensT=paste0(unique(ensT),collapse=" "),ensP=paste0(unique(ensP),collapse=" "),gene_name=paste0(unique(gene_name),collapse=" "),dist=ifelse(strand=="+",mean(map_start-transc_start),mean(transc_end-map_start))),by=c("dedRefID","strand")]
combined_unique_wide=reshape(combined_unique,timevar="strand",idvar="dedRefID",direction="wide")
dedRef_bed_coord=merge(dedRef_bed,dedRef_bam_dt,by="dedRefID",all=TRUE)
combined_unique_wide_coord=merge(dedRef_bed_coord,combined_unique_wide,by="dedRefID",all=TRUE)
combined_unique_wide_coord
bam_dir
ggplot(combined_unique,aes(x=dist))+geom_density()
library(ggplot2)
ggplot(combined_unique,aes(x=dist))+geom_density()
write.table(combined_unique_wide_coord,paste0(bam_dir,"/dedRef_sarHar1_annotation_ensT.tsv"),sep="\t",row.names=FALSE,quote=FALSE)
library(project.init)
project.init2("GBMatch")
library(LOLA)
nenv()
eload(loadAnnotation())
eload(loadGencodeGenes("human",versNum=87))
eload(loadUCSCRepeats())
repeats = SV$repeats
prom1k=promoters(SV$gencodeContainer$genesGR[SV$gencodeContainer$genes[,which(gene_biotype=="protein_coding")]], upstream=1000, downstream=500)
prom1k
